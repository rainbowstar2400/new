# Use Cases v0.1

- 作成日: 2026-02-06
- 対象プロダクト: 自分専用秘書PWA
- 参照: `ProductBrief_v0.1.md`
- スコープ: MVP（テキスト入力、自動分類、メモ内サブ分類、自然会話応答、要約スロットAI生成、ローカル保存、ローカル通知）

## 1. 目的

- 会話感覚の入力を、メモ/タスク/リマインドに分解して実装要件へ落とし込む
- 実装後の動作確認に使える受け入れ条件を定義する
- 人と会話しているように感じる応答文ルールを定義する

## 2. ユースケース一覧（MVP）

| ID | ユーザー入力例 | 想定分類 | 期待されるアプリ動作 | 受け入れ条件 |
| --- | --- | --- | --- | --- |
| UC-01 | 明日9時にAさんへ連絡 | タスク + リマインド | タスク作成、期限は翌日09:00、通知予約 | 保存完了まで5秒以内。タスク一覧に表示され、翌日09:00に通知される。応答は `Aさんへの連絡ですね。タスクに登録しました。明日9:00にリマインドします。` のような自然文になる |
| UC-02 | 牛乳を買うのを忘れないように | タスク（期日未指定） | タスクとして判定し、期日設定の3択を返す | `設定する/設定しない/後で設定する` の選択肢が提示される |
| UC-03 | 来週金曜の会議メモ: 議題は予算見直し | メモ（雑多） | メモとして保存、タスク化しない | メモ一覧に表示。通知は自動設定されない |
| UC-04 | 15時に薬を飲むって通知して | タスク + リマインド | タスク作成、当日15:00通知を予約 | 通知時刻が正しく設定され、通知タップで対象タスクが開く |
| UC-05 | 明後日までに請求書を送るの覚えておいて | タスク + リマインド | タスク作成、期限を明後日、通知を自動提案または自動設定 | 期限日が明後日として保存される。通知設定状態がUIで確認できる |
| UC-06 | 朝のルーティンを固定化すると体調が良さそう | メモ（アイデア） | メモ作成 | `メモ:` や `アイデア:` の接頭辞なしでも、メモ分類が `アイデア` で保存される |
| UC-07 | 今日の17時って通知して（対象未指定） | 不足情報 | 何を通知するか確認質問を返す | 不完全入力を誤保存しない。確認後にのみ保存される |
| UC-08 | 明日の打ち合わせをリマインドして（時刻なし） | タスク + 時刻補完確認 | 既定時刻を補完して `○/✕` で確認する | `期限を明日○時に設定します。時刻は○時で良いですか？` を表示。`○` で確定、`✕` の場合のみ自然言語で時刻入力を受け付ける |
| UC-09 | 地下鉄の定期更新、次の月曜に通知 | タスク + リマインド | タスク作成、次の月曜通知 | 相対日付が正しく解釈され、誤って今週月曜に設定されない |
| UC-10 | さっきのをメモじゃなくてタスクにして | 既存項目の再分類 | 直前項目の種別をメモ→タスクへ変更 | 種別変更が即時反映され、重複項目が作成されない |
| UC-11 | 最近読んだ本の感想を残しておきたい | メモ（やりたいこと） | メモとして保存 | `〜したい` `〜しておきたい` を含む入力は、接頭辞なしでも `やりたいこと` に分類される。応答は `最近読んだ本の感想の記録ですね。やりたいことに追加しておきます。` のような自然文になる |
| UC-12 | 今年は簿記3級を取りたい | メモ（やりたいこと） | メモ作成。目標系の文として `やりたいこと` に振り分ける | 接頭辞なしでも `やりたいこと` として保存される |
| UC-13 | 転職準備 | 判定保留（要確認） | タスクかメモか確認質問を返し、回答後に保存する | 曖昧入力は自動保存せず、`転職準備ですね。これはタスクにしますか？メモにしますか？` のような自然文の確認後に登録される |
| UC-14 | 時間ちょうどではなく、1時間前にリマインドして | リマインド調整 | 対象タスクの通知時刻を基準時刻の1時間前へ更新する | `1時間前` がオフセットとして解釈され、例: 10:00通知は9:00へ変更される。曖昧な場合は候補確認（`○/✕`）を返す |
| UC-15 | （`設定する` 選択後）来週金曜でお願いします | 期日設定応答 | `設定する` の次入力として期日を解釈し、対象タスクへ設定する | 自然言語返答が文脈付きで解釈され、対象タスクの期日が来週金曜へ更新される |
| UC-16 | （`後で設定する` を選択） | 期日保留 | 期日未設定のまま保存し、一覧で期日設定保留として強調表示する | 一覧で `!期日設定` が表示され、通常の `期日なし` タスクと視覚的に区別される |
| UC-17 | 1時間前にリマインドして（対象が複数候補） | 対象タスク確認 | 候補タスクを提示して `○/✕` で確認する | `対象タスクは〇〇で良いですか？` を表示。`✕` の場合のみ自然言語で対象指定を受け付ける |

## 3. 会話フロー定義（最小）

### 3.1 登録フロー

1. ユーザーが自然文で入力する
2. 入力が明確にメモなら `メモ` に分類する
3. 入力が明確にタスク/リマインドなら `タスク` に分類する
4. タスク判定で期日情報がない場合は `設定する/設定しない/後で設定する` を確認する
5. `設定する` が選択された場合のみ、期日の自然言語入力（例: `来週金曜で`）を受け付けて解釈する
6. `設定しない` が選択された場合は、通常の `期日なし` タスクとして保存する
7. `後で設定する` が選択された場合は、`!期日設定` フラグ付きで保存する
8. 期限が日付のみの場合は、既定時刻を補完して `○/✕` で確認する
9. `✕` が選択された場合のみ、自然言語で時刻入力を受け付ける
10. タスクかメモか曖昧な場合は確認質問を返す
11. `メモ` 判定時は `やりたいこと` `アイデア` `メモ（雑多）` のいずれかへ再分類する
12. 日時表現が含まれる場合はリマインド候補を抽出する
13. 情報が不足している場合のみ確認質問を返す
14. 確定情報から `〇〇`（要約フレーズ）を生成する
15. テンプレートに `〇〇` を埋め込み、保存完了または確認内容を自然文で返す（例: `Aさんへの連絡ですね。タスクに登録しました。`）

### 3.2 通知フロー

1. 通知時刻到達でローカル通知を表示する
2. 通知タップで該当項目詳細を開く
3. 詳細画面で `完了` または `あとで` を選べる

### 3.3 修正フロー

1. ユーザーが再分類や文言修正を指示する
2. 直近または指定項目へ変更を反映する
3. 変更結果を自然文で返す

### 3.4 リマインド調整フロー

1. ユーザーが通知タイミングの調整を指示する（例: `1時間前にリマインドして`）
2. アプリが対象タスクと基準時刻を特定する
3. `1時間前` `30分前` `前日` などのオフセット表現を解釈する
4. オフセットまたは対象タスクが曖昧な場合、候補を提示して `○/✕` で確認する
5. `✕` が選択された場合のみ、自然言語で補足入力を受け付ける
6. 通知時刻を再計算して更新する
7. 更新結果を自然文で返す

## 4. 応答スタイル仕様（MVP）

### 4.1 完了応答

- 先頭で要約フレーズ `〇〇` を復唱し、その後に実施内容を伝える
- 返答は自然で読みやすい長さとし、必要情報を省略しない
- 例（タスク）: `〇〇ですね。タスクに登録しました。`
- 例（やりたいこと）: `〇〇ですね。やりたいことに追加しておきます。`

### 4.2 確認質問応答

- 曖昧入力では二択で確認する
- 例: `〇〇ですね。タスクにしますか？メモにしますか？`
- 例（期日未指定タスク）: `〇〇ですね。期日はどうしますか？ 設定する / 設定しない / 後で設定する`
- 例（日付のみ期限）: `期限を○日に設定します。時刻は○時で良いですか？（○/✕）`
- 例（対象タスク確認）: `対象タスクは〇〇で良いですか？（○/✕）`
- 情報不足の場合は不足項目だけを質問する
- `〇〇` は入力文の語句を可能な限り維持し、タスク名として自然な形へ整える
- 期日確認の自然言語入力は `設定する` 選択後のみ受け付ける（例: `来週金曜で` `来月1日`）
- `○/✕` を使う確認では、`✕` が選択された場合のみ自然言語入力を受け付ける

### 4.3 文体ルール

- 丁寧語ベースで、事務的すぎる定型文を避ける
- 感嘆符は使ってよいが、多用しない
- 否定やエラー時も理由を添える

### 4.4 要約スロット生成ポリシー（`〇〇` 部分）

- 応答文全体はテンプレートで固定し、AI生成は `〇〇` 要約フレーズのみを対象にする
- 生成に渡す情報は「確定済みの事実」のみとし、新しい予定や時刻を推測で追加しない
- `〇〇` は要約しすぎず、入力文の主要語句を保持してタスク名として成立する形に整える
- `〇〇` は長さ制約より意味の保持を優先する
- 生成が失敗した場合、または不適切文（事実不一致、意味不明、空応答）の場合は定型的な要約へフォールバックする
- フォールバック例（タスク）: `〇〇ですね。タスクに登録しました。`
- フォールバック例（確認）: `〇〇ですね。タスクにしますか？メモにしますか？`

## 5. 日時解釈ルール（MVP）

- 相対日付（明日、明後日、来週金曜）を優先対応する
- 時刻が未指定のときは「確認質問」または「デフォルト時刻提案」を行う
- タスクで期日が未指定の場合は、`設定する/設定しない/後で設定する` の選択を返す
- `設定する` が選択された場合のみ、期日の自然言語返答を解釈して日付へ反映する
- `設定しない` は通常の `期日なし` として保存する
- `後で設定する` は `!期日設定` フラグ付きで保存する
- 期限が日付のみの場合は、既定時刻（設定値）を補完して `○/✕` で確認する
- `✕` が選択された場合のみ、自然言語で時刻入力を受け付ける
- 期限は必ず日時で保持し、日付のみ状態を残さない
- 期日自然言語の返答が曖昧な場合は、再確認質問を返す
- `1時間前` `30分前` など、オフセット指示は可能な限り広く解釈する
- オフセット指定または対象タスクが曖昧な場合は、候補提示して `○/✕` で確認する
- 過去日時に解釈された場合は自動保存せず、確認質問を返す

## 6. 分類ルール（MVP）

- 日時、期限、実行依頼（〜する、〜しておく）などタスク条件が明確なら `タスク` として扱う
- タスク条件に当てはまる入力は、期日未指定でも `タスク` として扱う
- 記録・感想・観察・発想メモなど明確にメモ用途なら、接頭辞の有無に関係なく `メモ` として保存する
- `タスク` と `メモ` のどちらにも取り得る曖昧な入力は、保存前にユーザーへ確認質問を返す
- `メモ` 判定後、目標や実現したい内容（`〜したい` `〜しておきたい` を含む）は `やりたいこと`、発想や改善案は `アイデア`、どちらにも当てはまらない内容は `メモ（雑多）` とする

## 7. 実装優先度

- P0: UC-01, UC-02, UC-03, UC-04, UC-06, UC-10, UC-11, UC-12, UC-13, UC-14, UC-15, UC-16, UC-17
- P1: UC-05, UC-08, UC-09
- P2: UC-07

## 8. テスト観点

- 保存速度: 入力開始から保存完了まで5秒以内
- 分類精度: メモ/タスクの誤分類率
- 曖昧判定: タスクかメモか怪しい入力で確認質問が返り、自動保存されないか
- 期日確認: 期日未指定タスクで `設定する/設定しない/後で設定する` の3択が返るか
- 期日返答解釈: `設定する` 選択後の自然言語返答（例: `来週金曜で`）が正しく期日設定へ反映されるか
- 期日保留表示: `後で設定する` のタスクに `!期日設定` が付き、通常の `期日なし` と区別されるか
- 日時確定: 期限が日付のみ入力でも、既定時刻確認後に日時として保存されるか
- `○/✕` 遷移: `✕` 選択時のみ自然言語入力へ遷移し、`○` では即確定するか
- サブ分類精度: メモが `やりたいこと` `アイデア` `メモ（雑多）` に適切に振り分けられるか
- 応答品質: 復唱 + 実施内容が自然文で返るか（機械的なラベル列挙にならないか）
- 要約品質: 入力文の主要語句を維持した `〇〇` が生成されるか（例: `最近読んだ本の感想の記録`）
- 入力尊重: `〇〇` でユーザー意図や対象語句が欠落していないか
- 要約安全性: `〇〇` 生成時に未確定情報を付け足さないか
- フォールバック動作: `〇〇` 生成失敗時に安全な要約へ確実に切り替わるか
- オフセット解釈: `1時間前` などの指示が基準時刻に対して正しく反映されるか
- 対象確認: 対象タスクが曖昧なとき `対象タスクは〇〇で良いですか？` の確認が返るか
- 通知精度: 指定日時に通知が発火するか
- 修正容易性: 再分類が1操作で完了するか
- 安全性: 不完全入力や曖昧入力を誤保存しないか
