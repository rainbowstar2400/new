# Use Cases v0.2

- 作成日: 2026-02-07
- 参照: `ProductBrief_v0.2.md`, `PRD_v0.2.md`, `UseCases_v0.1.md`
- スコープ: Online MVP

## 1. 目的

- 会話入力を実装可能な要件へ落とし込む
- 受け入れ条件をユースケース単位で定義する
- オンライン化（匿名ID/Push/GPT）で追加されたフローを明示する
- `v0.1` の重要挙動を回帰観点として維持する

## 2. ユースケース一覧

| ID | ユーザー入力/操作 | 想定分類 | 期待動作 | 受け入れ条件 |
| --- | --- | --- | --- | --- |
| UC-01 | 明日9時にAさんへ連絡 | タスク + リマインド | タスク作成、翌日09:00期限、通知予約 | 5秒以内保存、一覧表示、通知導線が動作 |
| UC-02 | 牛乳を買うのを忘れないように | タスク（期日未指定） | 3択確認を返す | `設定する/設定しない/後で設定する` が提示される |
| UC-04 | 15時に薬を飲むって通知して | タスク + リマインド | 当日15:00期限 + 通知予約 | 通知タップで対象タスクを開ける |
| UC-05 | 明後日までに請求書を送るの覚えておいて | タスク + リマインド | 期限と通知を設定（時刻未指定時は補足確認） | 期日が明後日として保存される |
| UC-08 | 明日の打ち合わせをリマインドして（時刻なし） | タスク + 時刻補完確認 | 既定時刻を補完し `○/✕` を返す | `✕` 選択時のみ自然言語で時刻補足入力へ遷移 |
| UC-09 | 地下鉄の定期更新、次の月曜に通知 | タスク + リマインド | 相対日付を解釈して期限設定 | 今週月曜への誤解釈をしない |
| UC-11 | 最近読んだ本の感想を残しておきたい | メモ（やりたいこと） | メモとして保存 | `〜たい/〜しておきたい` を `やりたいこと` として扱える |
| UC-13 | 転職準備 | 判定保留（要確認） | タスク/メモ確認を返す | 確認前に自動保存しない |
| UC-23 | （UC-13でメモ選択） | メモ分類確認 | `memo_category` を返してカテゴリ選択を要求 | カテゴリ選択前に保存しない |
| UC-14 | 1時間前にリマインドして | リマインド調整 | 対象タスクの通知時刻を再計算 | `1時間前` がオフセットとして反映される |
| UC-15 | （`設定する` 選択後）来週金曜でお願いします | 期日設定応答 | 文脈付きで期日設定 | 直前タスクに期日を更新できる |
| UC-16 | （`後で設定する` を選択） | 期日保留 | `pending_due` で保存 | 一覧で `!期日設定` 表示 |
| UC-17 | 1時間前にリマインドして（対象複数） | 対象確認 | 候補提示して `○/✕` 確認 | `✕` 時のみ自然言語で対象再指定 |
| UC-18 | 初回起動 | 匿名デバイス登録 | installation登録 + token取得 | インストール単位でデータ分離される |
| UC-19 | 通知を有効化ボタン押下 | Push購読 | 権限要求後に購読情報保存 | 初回起動時に自動許可要求しない |
| UC-20 | GPT要約生成が失敗 | NLGフォールバック | deterministic要約で応答継続 | 空応答や不整合応答を返さない |
| UC-21 | 確認中UI | 入力制御 | APIメタに応じて入力可否を制御 | `choice_only` で自由入力不可 |
| UC-22 | `✕` 選択後UI | 補足入力許可 | `✕` 選択後のみ自由入力へ遷移 | `choice_then_text_on_negative` を満たす |

## 3. 会話フロー

### 3.1 登録フロー

1. ユーザーが自然文入力
2. 明確な入力はタスク/メモへ分類
3. 曖昧入力は `タスク/メモ` 確認
4. `メモ` が選択された場合は `メモ分類` 確認を返す
5. タスクかつ期日未指定なら3択を提示
6. `設定する` 選択時のみ期日自然言語入力を受付
7. 日付のみの場合は既定時刻補完 + `○/✕` 確認
8. `✕` 選択時のみ補足自然言語入力を受付
9. 確定後に保存し応答文を返す

### 3.2 リマインド調整フロー

1. オフセット指示を解釈
2. 対象が曖昧な場合は候補確認 (`○/✕`)
3. `✕` 選択時のみ自然言語で対象再指定
4. 通知時刻を再計算し更新

### 3.3 通知フロー（Web Push）

1. ユーザー操作起点で通知許可を要求
2. 購読情報を保存
3. 配信ジョブで対象通知を送信
4. 通知タップで `taskId` 付きURLを開く
5. 該当タスク詳細へ遷移

## 4. 応答ポリシー

- 応答文はテンプレート固定
- `〇〇` 要約部分のみGPT生成
- `〇〇` は入力尊重を優先し、未確定情報を追加しない
- 不適切生成時は deterministic 要約へフォールバック
- 確認系フローでは `✕` 選択時のみ自然言語入力へ遷移

## 5. 日時解釈ポリシー

- 既定モード: `ai-first`
- AI結果は厳格検証し、検証失敗は確認質問へ戻す
- 主要対応: `明日/明後日/次の月曜/来週金曜/再来週` など
- 相対日付が曖昧なら確認質問を返す
- 過去日時に解釈された場合は保存せず再確認する

## 6. 入力制御ポリシー（追記）

- `inputMode=choice_only`: 自由入力不可、選択肢ボタンのみ有効
- `inputMode=choice_then_text_on_negative`: `✕` 選択後の応答でのみ自由入力可能
- `inputMode=free_text`: 自由入力可能

## 7. v0.1 回帰チェック

- `明日18時に洗濯` が `洗濯` として保存される
- `京都にいきたい` が `memo(want)` で保存される
- `転職準備` が自動保存されず確認質問になる
- `タスク/メモ` で `メモ` を選んだ直後は保存されず、必ず `メモ分類` を選択する



